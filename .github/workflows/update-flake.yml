name: Update flake inputs

on:
  workflow_dispatch:
  schedule:
    - cron: "0 0 * * SAT"

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - uses: ./.github/actions/build-setup
        with:
          cachixAuthToken: ${{ secrets.CACHIX_AUTH_TOKEN }}
          system: aarch64-linux
      - name: Update flake inputs
        uses: technote-space/create-pr-action@v2
        with:
          EXECUTE_COMMANDS: |
            updateOutput=$(nix flake update)
            checkOutput=$(nix flake check)
            cat <<EOF
            ### Updated inputs
            <details open>
            ```sh
            $updateOutput
            ```
            </details>

            ### Check results
            <details open>
            ```sh
            $checkOutput
            ```
            </details>
            EOF
          GITHUB_TOKEN: ${{ secrets.GHA_TOKEN }}
          COMMIT_MESSAGE: 'chore: Update flake inputs'
          PR_TITLE: 'chore: Update flake inputs'
          PR_BRANCH_NAME: update-flake-inputs
          PR_BODY: |
            ${COMMANDS_OUTPUT}
